Bottom: 77e6f9a64fe21d866c09b5e3cf02a3b39e104bc2
Top:    a8df00e32eb302f25f461a1ad37449e27699a5c5
Author: Ian Kent <ikent@redhat.com>
Date:   2013-04-08 09:57:09 +0800



---

diff --git a/lib/master.c b/lib/master.c
index a0e62f2..e3dc2cf 100644
--- a/lib/master.c
+++ b/lib/master.c
@@ -899,6 +899,8 @@ int master_notify_submount(struct autofs_point *ap, const char *path, enum state
 
 	mounts_mutex_lock(ap);
 
+	error(LOGOPT_ANY, "ap->path %s", ap->path);
+
 	head = &ap->submounts;
 	p = head->prev;
 	while (p != head) {
@@ -907,7 +909,13 @@ int master_notify_submount(struct autofs_point *ap, const char *path, enum state
 
 		if (!master_submount_list_empty(this)) {
 			mounts_mutex_unlock(ap);
-			return master_notify_submount(this, path, state);
+			error(LOGOPT_ANY, "notify submount %s", this->path);
+			if (!master_notify_submount(this, path, state)) {
+				ret = 0;
+				mounts_mutex_lock(ap);
+				break;
+			}
+			mounts_mutex_lock(ap);
 		}
 
 		/* path not the same */
